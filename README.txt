Scripts for the DFXM simulator using Python
To run the simulation code in this repository, you need to run “test_scripts.ipynb"
In each script, you will need to follow the instructions in the comments, making sure to clearly define the dislocation character with its burgers vector ‘be’, slip plane normal ‘ns’ and line vector ‘xi’ in line number 1. Line number 1 calculates the rotation matrix based on the normal and dislocation line directions, and then compares with the matrices in all 12 slip systems (transposed) of a FCC crystal. Run line number 2 and 3 to visualise the strain field of a perfect edge dislocation in the dislocation coordinates. Run line number 4 and 5 to visualize the rotated strain map for the pure edge dislocation in the grain coordinate system. Run line number 6 to visualize the strain field with dislocation in 3D in the grain coordinate system.
Then we move on to a new section starting from line number 7 where we calculate the resolution function of the microscope in the reciprocal space. In line number 7, define the experimental parameters. The experimental parameters currently entered in the code are based on an experiment performed at the ESRF by Dresselhaus-Marais et al. (2020). Set ‘two_theta’ to be the appropriate diffraction angle depending on the hkl diffraction peak. Define the dislocation character with burgers vector ‘bs’, slip plane normal ‘ns’ and line vector ‘ts’ and the Poisson’s ratio of the material ‘nu’.
Line number 9-10 loads the file ‘Resq_i.mat’ and helps visualize slices of the resolution function. Running line number 11 saves the resolution function to ‘Res_qi’.
You start simulating the forward model from line number 14 to study a simple case of a sphere of pure shear as shown in Figure 3. Again, you need to set the appropriate instrument parameters and the ‘two_theta’ for the hkl diffraction peak you want to study. 
Line number 15 loads the resolution function that was calculated previously and uses it to simulate the DFXM images. 
The DFXM images of a dislocation are simulated starting from line number 18. As described previously in this text, define the instrument parameters, dislocation character and the material constants in line number 18.
You start sweeping the parameters to look at rocking curves from line number 22. Run line number 23 to calculate and save the resolution function; load the same using line number 24. Line 25 calculates the images of the entire rocking (phi scan) and rolling (chi scan) curve. You can change the start and end positions of phi and chi for the rocking curves and the step size. Line number 26 plots the 2D chi-phi maps using the images calculated in line number 25 as shown in Figure 5. Run line numbers 27, 28 and 29 to visualize the strong beam and the weak beam images from the rocking curve images that was just calculated.
Finally, run line number 30 to visualize the images at each position in a phi rocking curve at a fixed chi value. Line 31 makes a plot of the maximum pixel value and minimum pixel value as a function of phi motor position from the DFXM images calculated using the phi rocking curve.
